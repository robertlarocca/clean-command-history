#!/bin/bash

# Copyright (c) 2022 Robert LaRocca http://www.laroccx.com

# require root privileges
require_root_privileges() {
	if [ $(id -u) != 0 ]; then
		logger -i "Error: $(basename $0 .sh) must be run as root!"
		echo "Error: $(basename $0 .sh) must be run as root!"
		exit 1
	fi
}

require_root_privileges

main() {
	# Install clean command
	cp -b -S .bak -v $PWD/clean /usr/local/bin/

	chown root:root /usr/local/bin/clean
	chmod 0755 /usr/local/bin/clean

	# Noninteractive (nologin) shells
	cat <<-EOF_XYZ >/etc/profile.d/clean.sh
		# Copyright (c) 2018-$(date +%Y) Robert LaRocca https://www.laroccx.com

		# This source code is governed by a MIT-style license that can be found in
		# the included LICENSE file. If not, see <https://mit-license.org/>.
		#
		# Source Code: https://github.com/robertlarocca/clean-command-history

		# Enable the clean command
		if [ -f /usr/local/bin/clean ]; then
			. /usr/local/bin/clean
		fi
	EOF_XYZ

	chown root:root /etc/profile.d/clean.sh
	chmod 0644 /etc/profile.d/clean.sh

	# Interactive (login) shells
	cat <<-EOF_XYZ >>/etc/bash.bashrc

		# Enable the clean command
		if [ -f /usr/local/bin/clean ]; then
			. /usr/local/bin/clean
		fi
	EOF_XYZ
}

main "$@"

# vi: syntax=sh ts=4 noexpandtab
